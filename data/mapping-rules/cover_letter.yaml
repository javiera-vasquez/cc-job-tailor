# Cover Letter Transformation Rules
# This file defines how to transform cover letter templates into job-specific versions

schema_version: "1.0"
description: "Rules for transforming cover letter templates into tailored, job-specific cover letters"

# Target output schema for tailored cover letters
target_schema:
  cover_letter:
    company: "string"                    # Target company name
    position: "string"                   # Target job position
    job_focus: "string"                  # ai_focused | qa_focused | frontend_focused
    date: "string"                       # Application date

    content:
      opening_paragraph: "string"        # Personalized opening
      body_paragraph_1: "string"         # Main qualifications/experience
      body_paragraph_2: "string"         # Specific achievements/examples
      closing_paragraph: "string"        # Call to action and next steps
      signature: "string"                # Professional signature block

    personalization:
      company_research: "array[string]"  # Company-specific insights included
      job_alignment: "array[string]"     # How experience aligns with job
      technical_matches: "array[string]" # Technical skills that match requirements

# Transformation rules
transformation_rules:

  # Template selection based on job focus
  template_selection:
    source: "cover_letter.templates"
    selection_key: "{{ job_focus }}"    # ai_focused | qa_focused | frontend_focused
    fallback: "frontend_focused"        # Default template if focus unclear

  # Variable replacement rules
  variable_replacement:
    - placeholder: "[POSITION]"
      source: "job_analysis.position"
      description: "Replace with exact job title from posting"

    - placeholder: "[COMPANY]"
      source: "job_analysis.company"
      description: "Replace with company name"

    - placeholder: "[INDUSTRY/DOMAIN]"
      source: "job_analysis.company_info.industry"
      fallback: "technology sector"
      description: "Replace with company's industry/domain"

    - placeholder: "[SPECIFIC_TECH]"
      source: "job_analysis.requirements.must_have_skills"
      transformation: "select_top_3_matching"
      description: "Replace with top 3 matching technical skills"

    - placeholder: "[TEAM_SIZE]"
      source: "job_analysis.responsibilities"
      extraction_pattern: "team of (\\d+)|manage (\\d+)|lead (\\d+)"
      description: "Extract team size if mentioned in responsibilities"

    - placeholder: "[PROJECT_TYPE]"
      source: "job_analysis.responsibilities.primary"
      transformation: "extract_project_keywords"
      description: "Extract type of projects from job responsibilities"

  # Content enhancement rules
  content_enhancement:

    # Technical skill integration
    technical_alignment:
      rule: "integrate_matching_skills"
      logic: |
        1. Compare job requirements with candidate technical expertise
        2. Select top 5 most relevant matches
        3. Naturally integrate into body paragraphs
        4. Avoid forced keyword stuffing

    # Achievement selection
    achievement_selection:
      rule: "select_relevant_achievements"
      logic: |
        1. Analyze job responsibilities and requirements
        2. Score candidate achievements by relevance (0-10)
        3. Select top 2-3 most impactful achievements
        4. Quantify impact with specific metrics where available

    # Company research integration
    company_research:
      rule: "add_company_insights"
      sources: ["job_analysis.company_info", "external_research"]
      max_insights: 2
      logic: |
        1. Include 1-2 specific company insights
        2. Connect insights to candidate's experience
        3. Show genuine interest and research effort

  # Tone and style adjustments
  tone_adjustments:

    # Enthusiasm level based on job focus
    enthusiasm_mapping:
      ai_focused: "high"          # Show excitement about AI innovation
      qa_focused: "professional"  # Emphasize reliability and precision
      frontend_focused: "balanced" # Balance technical expertise with user focus

    # Formality level based on company size
    formality_mapping:
      startup: "slightly_informal"     # More conversational, show cultural fit
      mid_size: "professional"        # Standard business professional
      large: "formal"                 # More formal, traditional corporate style

    # Technical depth based on role level
    technical_depth:
      junior: "foundational"          # Focus on learning and potential
      mid_level: "balanced"           # Mix of technical and soft skills
      senior: "advanced"              # Deep technical expertise and leadership

# Quality enhancement rules
quality_rules:

  # Content validation
  content_validation:
    - rule: "No generic statements"
      description: "Every paragraph should be specific to the company and role"

    - rule: "Quantified achievements"
      description: "Include specific metrics and numbers where possible"

    - rule: "Natural keyword integration"
      description: "Technical terms should flow naturally, not feel forced"

    - rule: "Consistent tone"
      description: "Maintain consistent professional tone throughout"

  # Length constraints
  length_constraints:
    total_length:
      min_words: 200
      max_words: 400
      target: 300

    paragraph_lengths:
      opening_paragraph: 50-80
      body_paragraph_1: 80-120
      body_paragraph_2: 80-120
      closing_paragraph: 40-60

  # Personalization requirements
  personalization_requirements:
    min_company_mentions: 3
    min_specific_details: 2
    required_elements:
      - "Specific job title mention"
      - "Company name integration"
      - "Relevant technical skills"
      - "Quantified achievements"

# Output formatting rules
formatting_rules:

  # Professional formatting
  structure:
    - "Date line"
    - "Company address (if available)"
    - "Formal greeting (Dear Hiring Manager/Team)"
    - "Opening paragraph"
    - "Two body paragraphs"
    - "Closing paragraph"
    - "Professional signature block"

  # Style guidelines
  style:
    greeting: "Dear Hiring Manager" # Default if no specific contact
    closing: "Best regards"
    font_style: "professional"
    tone: "confident but humble"

# Integration with job analysis
job_analysis_integration:

  # Required job analysis fields
  required_fields:
    - "job_analysis.company"
    - "job_analysis.position"
    - "job_analysis.job_focus"
    - "job_analysis.requirements.must_have_skills"

  # Optional enhancement fields
  enhancement_fields:
    - "job_analysis.company_info.industry"
    - "job_analysis.responsibilities.primary"
    - "job_analysis.company_info.culture"
    - "job_analysis.experience_level"

# Usage instructions for resume-tailor agent
usage_instructions: |
  1. Load appropriate template based on job_focus from job_analysis
  2. Replace all placeholder variables with job-specific information
  3. Apply content enhancement rules to personalize paragraphs
  4. Integrate company research and technical alignment
  5. Adjust tone based on company type and role level
  6. Validate content against quality rules
  7. Format according to professional structure
  8. Save as cover_letter.yaml in company-specific folder

# Example transformation workflow
example_workflow: |
  Input: job_analysis.yaml + cover_letter.templates.ai_focused
  Process:
    1. Replace [COMPANY] with "TechCorp"
    2. Replace [POSITION] with "Senior AI Engineer"
    3. Integrate matching skills: "LangChain, Vector embeddings, React"
    4. Add company insight: "TechCorp's focus on ethical AI development"
    5. Select relevant achievement: "Seeker project with $0.003/query economics"
    6. Adjust tone for startup culture (slightly informal)
  Output: Personalized cover_letter.yaml for TechCorp application